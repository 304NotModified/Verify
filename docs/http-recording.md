<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/http-recording.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Http Recording

Http Recording allows, when a method is being tested, for any http requests made as part of that method call to be recorded and verified.


## Usage

Call `HttpRecording.StartRecording();` before the method being tested is called.

The perform the verification as usual:

<!-- snippet: HttpRecording -->
<a id='snippet-httprecording'></a>
```cs
[Fact]
public async Task TestHttpRecording()
{
    HttpRecording.StartRecording();

    var sizeOfResponse = await MethodThatDoesHttpCalls();

    await Verifier.Verify(
            new
            {
                sizeOfResponse,
            })
        //scrub some headers that are no consistent between test runs
        .ScrubLinesContaining("AGE", "Server", "Date", "Etag");
}

static async Task<int> MethodThatDoesHttpCalls()
{
    using var client = new HttpClient();

    var exampleResult = await client.GetStringAsync("https://example.net/");
    var httpBinResult = await client.GetStringAsync("https://httpbin.org/");
    return exampleResult.Length + httpBinResult.Length;
}
```
<sup><a href='/src/Verify.Tests/Tests.cs#L25-L52' title='Snippet source file'>snippet source</a> | <a href='#snippet-httprecording' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

The requests/response pairs will be appended to the verified file.

<!-- snippet: Tests.TestHttpRecording.verified.txt -->
<a id='snippet-Tests.TestHttpRecording.verified.txt'></a>
```txt
{
  target: {
    sizeOfResponse: 10847
  },
  httpRequests: [
    {
      Uri: https://example.net/,
      Status: RanToCompletion,
      RequestHeaders: {},
      ResponseHeaders: {
        Vary: Accept-Encoding,
        X-Cache: HIT
      }
    },
    {
      Uri: https://httpbin.org/,
      Status: RanToCompletion,
      RequestHeaders: {},
      ResponseHeaders: {
        Access-Control-Allow-Credentials: true,
        Access-Control-Allow-Origin: *,
        Connection: keep-alive,
      }
    }
  ]
}
```
<sup><a href='/src/Verify.Tests/Tests.TestHttpRecording.verified.txt#L1-L26' title='Snippet source file'>snippet source</a> | <a href='#snippet-Tests.TestHttpRecording.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
